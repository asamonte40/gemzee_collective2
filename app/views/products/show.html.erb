<div class="container product-page py-5">

  <!-- MAIN ROW: IMAGE (left) | DETAILS (right) -->
  <div class="row g-4 align-items-start">

    <!-- LEFT: LARGE IMAGE -->
    <div class="col-lg-6">
      <div class="product-image-wrapper card shadow-sm h-100">
        <div class="card-body d-flex align-items-center justify-content-center p-0">
          <% if @product.image.attached? %>
            <%= image_tag @product.image, class: "img-fluid product-image-large w-100 h-100 rounded-start", alt: @product.name %>
          <% else %>
            <div class="no-image-placeholder d-flex align-items-center justify-content-center text-muted w-100 p-5">
              <i class="bi bi-image" style="font-size: 2rem"></i>
              <span class="ms-2">No Image Available</span>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- RIGHT: DETAILS -->
    <div class="col-lg-6">
      <div class="product-details-wrapper card shadow-sm h-100">
        <div class="card-body d-flex flex-column">

          <h1 class="product-title mb-2"><%= @product.name %></h1>

          <p class="product-price display-6 fw-bold text-gold mb-3"><%= number_to_currency(@product.price) %></p>

          <p class="product-description text-muted mb-3"><%= @product.description %></p>

          <p class="mb-3"><strong>Category:</strong> <%= @product.category.name %></p>

          <% if @product.stock_quantity > 0 %>
            <p class="in-stock text-success mb-3">In Stock: <%= @product.stock_quantity %></p>

            <%= form_with url: add_to_cart_path(@product), method: :post, local: true, class: "mb-3" do %>
              <div class="row g-2 align-items-center">
                <div class="col-auto">
                  <label class="form-label mb-0">Qty</label>
                  <%= number_field_tag :quantity, 1, min: 1, max: @product.stock_quantity, class: "form-control quantity-input" %>
                </div>
                <div class="col">
                  <%= submit_tag "Add to Cart", class: "btn btn-gold btn-lg w-100 mt-4 mt-sm-0" %>
                </div>
              </div>
            <% end %>

          <% else %>
            <p class="text-danger fw-semibold mb-3">Out of Stock</p>
          <% end %>

          <div class="mt-auto">
            <%= link_to "Back to Products", products_path, class: "btn btn-outline-secondary" %>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- YOU MAY ALSO LIKE -->
  <h2 class="similar-title mt-5 text-center fw-bold">You may also like</h2>

  <div class="row mt-3 g-4">
    <% @similar_products&.first(3)&.each do |p| %>
      <div class="col-md-4">
        <div class="similar-card card h-100 text-center shadow-sm">
          <%= link_to product_path(p), class: "text-decoration-none text-dark" do %>
            <% if p.image.attached? %>
              <%= image_tag p.image, class: "similar-image img-fluid card-img-top", alt: p.name %>
            <% else %>
              <div class="card-img-top no-image-small d-flex align-items-center justify-content-center">
                <i class="bi bi-image" style="font-size: 1.5rem"></i>
              </div>
            <% end %>

            <div class="card-body">
              <p class="mb-1 fw-semibold similar-name"><%= p.name %></p>
              <p class="mb-0 text-gold similar-price"><%= number_to_currency(p.price) %></p>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
